{"version":3,"sources":["../src/gauge.js"],"names":[],"mappings":"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","file":"gauge.js","sourcesContent":["import * as d3 from './vender/d3'\r\nexport function directive_gauge($timeout){\r\n\t\treturn{\r\n\t\t\trestrict: 'E',\r\n\t\t\tscope:{\r\n\t\t\t\tdata:'=',\r\n\t\t\t\tconfig:'=',\r\n\t\t\t\tindicators:'=',\r\n\t\t\t\tsize:'='\r\n\t\t\t},\r\n\t\t\ttemplate: `\r\n\t\t\t\t<div  bs-tooltip=\"config.pointer.target+': '+data.pointer +'<br>'+config.temperature.target+': '+data.temperature+'<br>'+config.water_mark.target+': '+data.water_mark\" >\r\n\t\t\t\t\t<div style=\"display:block;margin: 0 auto; width: {{size}}px\" id=\"gauge-{{gaugeid}}\"> </div>\r\n\t\t\t\t\t<div  style=\"display:block; margin: 0 auto; width: {{size}}px; text-align: center\">\r\n\t\t\t\t\t\t<div ng-repeat=\"ind in indicators\" ng-style=\"styleIndicator(ind)\" bs-tooltip=\"ind.target+':'+ind.value\">{{ind.name}}</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>`,\r\n\t\t\tlink:function(scope, element, attrs) {\r\n\t\t\t\tscope.gaugeid=scope.$id\r\n\t\t\t\tvar gauge_created=false;\r\n\t\t\t\tvar g = null;\r\n\t\t\t\tfunction recreate_gauge(){\r\n\t\t\t\t\tif( scope.size>0 &&\r\n\t\t\t\t\t\t  (scope.config.temperature!=undefined && scope.config.temperature.min!==undefined && scope.config.temperature.min< scope.config.temperature.max) &&\r\n\t\t\t\t\t\t\t(scope.config.water_mark!=undefined && scope.config.water_mark.min!==undefined && scope.config.water_mark.min< scope.config.water_mark.max) &&\r\n\t\t\t\t\t\t\t(scope.config.pointer!=undefined && scope.config.pointer.min!==undefined && scope.config.pointer.min< scope.config.pointer.max)){\r\n\t\t\t\t\t\t\t\tg=new Gauge('gauge-'+scope.gaugeid,scope.size,scope.config,scope.data);\r\n\t\t\t\t\t\t\t\tg.render();\r\n\t\t\t\t\t\t\t\tgauge_created=true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tscope.styleIndicator=function(ind){\r\n\t\t\t\t\tvar indicator_style={\r\n\t\t\t\t\t\t  'padding': '2px 3px 1px 3px',\r\n\t\t\t\t\t\t  'color': '#fff',\r\n\t\t\t\t\t\t  'font-size': '0.917em',\r\n\t\t\t\t\t\t  'text-transform': 'uppercase',\r\n\t\t\t\t\t\t  'text-align': 'center',\r\n\t\t\t\t\t\t  'min-width': '0.7em',\r\n\t\t\t\t\t\t  'line-height': '1em',\r\n\t\t\t\t\t\t  'display': 'inline-block',\r\n\t\t\t\t\t\t  '-webkit-border-radius': '2px',\r\n\t\t\t\t\t\t  '-moz-border-radius': '2px',\r\n\t\t\t\t\t\t  'border-radius': '2px'\r\n\t\t\t\t\t};\r\n\t\t\t\t\tvar style_red = Object.assign({'border': '1px solid #d23d3d', 'background-color': '#d64e4e'},indicator_style);\r\n\t\t\t\t\tvar style_green = Object.assign({'border': '1px solid #2f9f5e','background-color': '#34af67'},indicator_style);\r\n\t\t\t\t\tif(ind.value!=undefined && ind.value>=ind.min && ind.value <=ind.max) {\r\n\t\t\t\t\t\treturn style_green;\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\treturn style_red;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\tscope.$on('$locationChangeSuccess',function(){\r\n\t\t\t\t\tif(gauge_created){\r\n\t\t\t\t\t\t g.render(); //if windows location changed, we need to update our absolute url references in svg\r\n\t\t\t\t\t }\r\n\t\t\t\t});\r\n\t\t\t\tscope.$watch('config',recreate_gauge,true);\r\n\t\t\t\tscope.$watch('size',recreate_gauge,true);\r\n\t\t\t\tscope.$watch('data',function(){\r\n\t\t\t\t\tif(gauge_created)\r\n\t\t\t\t\t\tg.redraw(scope.data);\r\n\t\t\t\t\telse{\r\n\t\t\t\t\t\trecreate_gauge();\r\n\t\t\t\t\t}\r\n\t\t\t\t},true);\r\n\t\t\t\t$timeout(recreate_gauge,100);\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t\tfunction Gauge(placeHolder,gauge_size,config,data){\r\n\t\t\tthis.placeHolder=placeHolder;\r\n\t\t\tvar self=this;\r\n\t\t\tvar pointer=config.pointer;\r\n\t\t\tvar temperature=config.temperature;\r\n\t\t\tvar water_mark=config.water_mark;\r\n\t\t\tvar baseUrl;\r\n\r\n\t\t\tvar clip,circle_c,circle_s,title_f,title_m,title_v,svg_pointer;\r\n\t\t\tfunction valueToDegrees(value)\t{return value/pointer.range * 240 - 30;}\r\n\t\t\tfunction valueToRadians(value)  {return valueToDegrees(value) * Math.PI / 180;\t}\r\n\t\t\tfunction valueToPoint(value, factor){\r\n\t\t\t\treturn {x: gauge_size/2 - gauge_size/2 * factor * Math.cos(valueToRadians(value)),\r\n\t\t\t\t\t\ty: gauge_size/2 - gauge_size/2 * factor * Math.sin(valueToRadians(value))}\r\n\t\t\t\t;\r\n\t\t\t};\r\n\t\t\tfunction scale(value){\r\n\t\t\t\tif(value>=this.max)\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\telse if(value<=this.min)\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\telse\r\n\t\t\t\t\treturn (value-this.min)/this.range;\r\n\t\t\t};\r\n\t\t\tthis.render=function(){\r\n\t\t\t\tfunction buildPointerPath(value){\r\n\t\t\t\t\tvar delta = pointer.range/20;\r\n\r\n\t\t\t\t\tvar head = valueToPoint(value, 0.85);\r\n\t\t\t\t\tvar head1 = valueToPoint(value - delta, 0.12);\r\n\t\t\t\t\tvar head2 = valueToPoint(value + delta, 0.12);\r\n\r\n\t\t\t\t\tvar tailValue = value+pointer.range/240*180;\r\n\t\t\t\t\tvar tail = valueToPoint(tailValue, 0.28);\r\n\t\t\t\t\tvar tail1 = valueToPoint(tailValue - delta, 0.12);\r\n\t\t\t\t\tvar tail2 = valueToPoint(tailValue + delta, 0.12);\r\n\r\n\t\t\t\t\treturn [head, head1, tail2, tail, tail1, head2, head];\r\n\t\t\t\t};\r\n\t\t\t  baseUrl=window.location.href;\r\n\t\t\t\tpointer.range=pointer.max-pointer.min;\r\n\t\t\t\tpointer.scale=_.bind(scale,pointer);\r\n\t\t\t\ttemperature.range=temperature.max-temperature.min;\r\n\t\t\t\ttemperature.scale=_.bind(scale,temperature);\r\n\t\t\t\twater_mark.range=water_mark.max-water_mark.min;\r\n\t\t\t\twater_mark.scale=_.bind(scale,water_mark);\r\n\t\t\t\t//remove the previous svg if exists\r\n\t\t\t\td3.select('#'+self.placeHolder).select(\"#svg-\"+self.placeHolder).remove();\r\n\t\t\t\tvar body=d3.select('#'+self.placeHolder)\r\n\t\t\t\t\t.append(\"svg\").attr(\"id\",\"svg-\"+self.placeHolder).attr('width',gauge_size).attr('height',gauge_size);\r\n\t\t\t\tvar defs=body.append(\"defs\");\r\n\t\t\t\tvar filter=defs.append(\"filter\").attr('id','dropshadow').attr('height','160%')\r\n\t\t\t\t\tfilter.append('feGaussianBlur').attr('in','SourceAlpha').attr('stdDeviation',5).attr('result','blur')\r\n\t\t\t\t\tfilter.append('feOffset').attr('in','blur').attr('dx',0).attr('dy',3).attr('result','offsetblur')\r\n\t\t\t\t\tvar feMerge=filter.append('feMerge');\r\n\t\t\t\t\tfeMerge.append('feMergeNode').attr('in','offsetblur')\r\n\t\t\t\t\tfeMerge.append('feMergeNode').attr('in','SourceGraphic')\r\n\t\t\t\tclip=defs.append(\"clipPath\").attr('id','rectclip_'+self.placeHolder)\r\n\t\t\t\t\t\t.append(\"rect\")\r\n\t\t\t\t\t\t\t.attr('x',0)\r\n\t\t\t\t\t\t\t.attr('height',gauge_size)\r\n\t\t\t\t\t\t\t.attr('width',gauge_size)\r\n\t\t\t\t;\r\n\t\t\t\tcircle_s=body.append(\"circle\")\r\n\t\t\t\t\t\t.attr(\"cx\",gauge_size/2).attr(\"cy\",gauge_size/2)\r\n\t\t\t\t\t\t.attr(\"r\",gauge_size/2-3)\r\n\t\t\t\t;\r\n\t\t\t\tcircle_c=body.append('circle')\r\n\t\t\t\t\t\t.attr(\"cx\",gauge_size/2).attr(\"cy\",gauge_size/2)\r\n\t\t\t\t\t\t.attr(\"r\",gauge_size/2-3)\r\n\t\t\t\t\t\t.attr('clip-path','url('+baseUrl+'#rectclip_'+self.placeHolder+')')\r\n\t\t\t\t\t\t.attr(\"style\",\"stroke:rgb(0,0,0);stroke-width:0;z-index:10000;\")\r\n\t\t\t\t;\r\n\t\t\t\ttitle_f=body.append(\"text\")\r\n\t\t\t\t\t\t.attr('x',gauge_size/2)\r\n\t\t\t\t\t\t.attr('style','font-weight:bold;text-anchor:middle;')\r\n\t\t\t\t\t\t.style('font-size',gauge_size/17)\r\n\t\t\t\t;\r\n\t\t\t\ttitle_m=body.append('text')\r\n\t\t\t\t\t\t.attr('x',gauge_size/2).attr('y',gauge_size/4)\r\n\t\t\t\t\t\t.attr('style','font-weight:bold;text-anchor:middle;')\r\n\t\t\t\t\t\t.style('font-size',gauge_size/15)\r\n\t\t\t\t\t\t.text(pointer.name)\r\n\t\t\t\t;\r\n\t\t\t\ttitle_v=body.append('text')\r\n\t\t\t\t\t\t.attr('x',gauge_size/2).attr('y',gauge_size/8*3)\r\n\t\t\t\t\t\t.attr('style','font-weight:bold;text-anchor:middle')\r\n\t\t\t\t\t\t.style('font-size',gauge_size/10)\r\n\t\t\t\t;\r\n\t\t\t\tvar tickers=body.append('g');\r\n\t\t\t\t_.each(_.range(0,pointer.range+1,pointer.range/4),function(tck){\r\n\t\t\t\t\tvar pt1=valueToPoint(tck,0.8);\r\n\t\t\t\t\tvar pt2=valueToPoint(tck,0.9);\r\n\t\t\t\t\ttickers.append('line')\r\n\t\t\t\t\t\t\t.attr('x1',pt1.x).attr('y1',pt1.y)\r\n\t\t\t\t\t\t\t.attr('x2',pt2.x).attr('y2',pt2.y)\r\n\t\t\t\t\t\t\t.attr('style','stroke:#333;stroke-width:2px');\r\n\t\t\t\t\tif(tck<pointer.max){\r\n\t\t\t\t\t\t_.each(_.range(tck,tck+pointer.range/4,pointer.range/20),function(tck2){\r\n\t\t\t\t\t\t\tvar pt1=valueToPoint(tck2,0.85);\r\n\t\t\t\t\t\t\tvar pt2=valueToPoint(tck2,0.9);\r\n\t\t\t\t\t\t\ttickers.append('line')\r\n\t\t\t\t\t\t\t\t\t.attr('x1',pt1.x).attr('y1',pt1.y)\r\n\t\t\t\t\t\t\t\t\t.attr('x2',pt2.x).attr('y2',pt2.y)\r\n\t\t\t\t\t\t\t\t\t.attr('style','stroke:#333;stroke-width:1px');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tsvg_pointer=body.append('g');\r\n\t\t\t\tsvg_pointer.selectAll('path')\r\n\t\t\t\t\t\t.data([buildPointerPath(pointer.range/2)])\r\n\t\t\t\t\t\t\t.enter().append('path')\r\n\t\t\t\t\t\t\t\t.attr('d',d3.svg.line().x(function(d){return d.x;}).y(function(d){return d.y;}).interpolate('basis'))\r\n\t\t\t\t\t\t\t\t.attr('style','stroke:#c63110;fill-opacity:0.6')\r\n\t\t\t\t;\r\n\t\t\t\tsvg_pointer.append('circle')\r\n\t\t\t\t\t\t.attr('cx',gauge_size/2).attr('cy',gauge_size/2)\r\n\t\t\t\t\t\t.attr('r',gauge_size/50)\r\n\t\t\t\t\t\t.attr('style','fill:#4684EE;stroke:#666;opacity:1')\r\n\t\t\t\t;\r\n\t\t\t\tself.redraw(data);\r\n\t\t\t};\r\n\t\t\tthis.calcWaterMark=function(d){\r\n\t\t\t\tif(water_mark.value_as_space){\r\n\t\t\t\t  return water_mark.scale(d.water_mark);\r\n\t\t\t  }else {\r\n\t\t\t\t\treturn 1-water_mark.scale(d.water_mark);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t\tthis.redraw=function(data){\r\n\t\t\t\t\tclip.data([data])\r\n\t\t\t\t\t\t.transition().duration(1)\r\n\t\t\t\t\t\t.attr('y',function(d){return gauge_size*self.calcWaterMark(d)-3;});\r\n\t\t\t\t\tcircle_c.data([data])\r\n\t\t\t\t\t\t.attr(\"fill\",function(d) { return \"hsl(\"+120*(1-temperature.scale(d.temperature))+\",100%,60%)\";});\r\n\t\t\t\t\tcircle_s.data([data])\r\n\t\t\t\t\t\t.attr(\"style\",function(d) { return \"stroke:hsl(\"+120*(1-temperature.scale(d.temperature))+\",100%,60%);stroke-width:2;fill:white;filter:url(\"+baseUrl+\"#dropshadow)\";});\r\n\t\t\t\t\ttitle_f.data([data])\r\n\t\t\t\t\t\t.attr('y',function(d) { return gauge_size*self.calcWaterMark(d)-3})\r\n\t\t\t\t\t\t.text(function(d) { return water_mark.name+':'+Math.round(d.water_mark)+' '+temperature.name+':'+Math.round(d.temperature)});\r\n\t\t\t\t\ttitle_v.data([data])\r\n\t\t\t\t\t\t.text(function(d){return Math.round(d.pointer)});\r\n\t\t\t\t\tsvg_pointer.data([data])\r\n\t\t\t\t\t\t.attr('transform',function(d){\r\n\t\t\t\t\t\t\treturn 'rotate('+ (pointer.scale(d.pointer)*240-120) +',' +gauge_size/2+','+gauge_size/2+')'})\r\n\t\t\t\t\t\t.style('fill',function(d) {return \"hsl(\"+120*(1-temperature.scale(d.temperature))+\",100%,60%)\";})\r\n\t\t\t\t\t;\r\n\t\t\t}\r\n\t\t};\r\n"]}